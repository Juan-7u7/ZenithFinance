<div class="auth-container">
  <div class="auth-card glass-card">
    @if (!isSubmitted()) {
      <h1>Nueva Contraseña</h1>
      <p class="subtitle">Ingresa tu nueva contraseña para acceder a tu cuenta</p>

      @if (errorMessage()) {
        <div class="error-alert">
          {{ errorMessage() }}
        </div>
      }

      <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="auth-form">
        <div class="form-group">
          <label for="password">Nueva Contraseña</label>
          <div class="password-wrapper">
            <input
              id="password"
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              placeholder="Mínimo 8 caracteres"
              [class.error]="resetForm.get('password')?.touched && resetForm.get('password')?.invalid"
            />
            <button 
              type="button" 
              class="toggle-password" 
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="showPassword() ? 'Ocultar' : 'Mostrar'"
            >
              <lucide-icon [img]="showPassword() ? icons.EyeOff : icons.Eye" size="18"></lucide-icon>
            </button>
          </div>
          @if (getErrorMessage('password')) {
            <span class="error-message">{{ getErrorMessage('password') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Contraseña</label>
          <div class="password-wrapper">
            <input
              id="confirmPassword"
              [type]="showConfirmPassword() ? 'text' : 'password'"
              formControlName="confirmPassword"
              placeholder="Repite tu nueva contraseña"
              [class.error]="resetForm.get('confirmPassword')?.touched && (resetForm.get('confirmPassword')?.invalid || resetForm.hasError('passwordMismatch'))"
            />
            <button 
              type="button" 
              class="toggle-password" 
              (click)="toggleConfirmPasswordVisibility()"
              [attr.aria-label]="showConfirmPassword() ? 'Ocultar' : 'Mostrar'"
            >
              <lucide-icon [img]="showConfirmPassword() ? icons.EyeOff : icons.Eye" size="18"></lucide-icon>
            </button>
          </div>
          @if (getErrorMessage('confirmPassword')) {
            <span class="error-message">{{ getErrorMessage('confirmPassword') }}</span>
          }
        </div>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="resetForm.invalid || isLoading()"
        >
          @if (isLoading()) {
            <span class="loading">Actualizando...</span>
          } @else {
            <span>Actualizar Contraseña</span>
          }
        </button>
      </form>
    } @else {
      <div class="success-state fade-in">
        <div class="success-icon">
          <lucide-icon [img]="icons.CheckCircle" size="48"></lucide-icon>
        </div>
        <h2>¡Contraseña Actualizada!</h2>
        <p>Tu contraseña ha sido cambiada correctamente. Ya puedes iniciar sesión con tus nuevas credenciales.</p>
        <button class="btn btn-primary" routerLink="/auth/login">
          Ir al Login
        </button>
      </div>
    }
  </div>
</div>
