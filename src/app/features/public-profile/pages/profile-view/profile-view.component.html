<div class="public-profile-container fade-in" *ngIf="profile(); else loadingTpl">
  
  <button class="btn-back-floating" (click)="goBack()">
    <lucide-icon [img]="icons.ArrowLeft" size="20"></lucide-icon>
    Regresar
  </button>

  <header class="profile-page-header">
    <div class="profile-banner"></div>
    
    <div class="profile-header-main">
      <div class="profile-identity-container">
        <div class="avatar-outer">
          <div class="avatar-wrapper">
             <img [src]="profile()?.avatar_url || ''" (error)="$event.target['src']=''" alt="Avatar" *ngIf="profile()?.avatar_url; else placeholder">
             <ng-template #placeholder>
               <div class="avatar placeholder">
                 {{ profile()?.name?.charAt(0)?.toUpperCase() || 'U' }}
               </div>
             </ng-template>
          </div>
          <div class="status-badge" *ngIf="isOwnProfile()">
             <lucide-icon [img]="icons.Shield" size="12"></lucide-icon>
          </div>
        </div>

        <div class="info-content">
          <div class="name-row">
            <h1>{{ profile()?.name }}</h1>
            <lucide-icon [img]="icons.Check" size="18" class="verified-icon" *ngIf="profile()?.privacy_settings?.show_assets"></lucide-icon>
          </div>
          <span class="username">@{{ profile()?.username }}</span>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn-share-alt" (click)="generateSnapshot()" title="Compartir Perfil">
           <lucide-icon [img]="icons.Share2" size="20"></lucide-icon>
        </button>

        <ng-container *ngIf="!isOwnProfile()">
          <button 
            [class]="isFollowing() ? 'btn btn-following' : 'btn btn-follow'"
            (click)="toggleFollow()"
            [disabled]="isProcessingFollow()"
          >
            <lucide-icon [img]="isFollowing() ? icons.Check : icons.Plus" size="18"></lucide-icon>
            {{ isFollowing() ? 'Siguiendo' : 'Seguir' }}
          </button>
        </ng-container>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar glass-card">
      <div class="stat-item">
        <div class="stat-icon followers">
          <lucide-icon [img]="icons.Users" size="18"></lucide-icon>
        </div>
        <div class="stat-data">
          <span class="label">Seguidores</span>
          <span class="value">--</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon assets">
          <lucide-icon [img]="icons.Briefcase" size="18"></lucide-icon>
        </div>
        <div class="stat-data">
          <span class="label">Activos</span>
          <span class="value">{{ assets().length }}</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon performance">
          <lucide-icon [img]="icons.TrendingUp" size="18"></lucide-icon>
        </div>
        <div class="stat-data">
          <span class="label">Zenith Score</span>
          <span class="value">Excellence</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Content Grid -->
  <main class="profile-content">
    
    <section class="section-card portfolio-highlights glass-card">
      <div class="section-header">
        <div class="title-with-icon">
          <lucide-icon [img]="icons.Briefcase" size="20"></lucide-icon>
          <h2>Portafolio Público</h2>
        </div>
        <span class="privacy-badge" [class.locked]="!profile()?.privacy_settings?.show_assets">
           <lucide-icon [img]="profile()?.privacy_settings?.show_assets ? icons.Shield : icons.Lock" size="14"></lucide-icon> 
           {{ profile()?.privacy_settings?.show_assets ? 'Verificado' : 'Privado' }}
        </span>
      </div>

      <div class="assets-modern-grid" *ngIf="assets().length > 0; else emptyOrPrivate">
        <div class="asset-pill" *ngFor="let asset of assets()">
          <div class="pill-info">
            <span class="symbol">{{ asset.symbol }}</span>
            <span class="name">{{ asset.name }}</span>
          </div>
          <div class="pill-value">
            <span class="total">{{ formatCurrency(asset.value) }}</span>
            <span class="qty">{{ asset.quantity }} units</span>
          </div>
        </div>
      </div>

      <ng-template #emptyOrPrivate>
        <div class="empty-state">
           <lucide-icon [img]="icons.Shield" size="48" class="icon-muted"></lucide-icon>
           <p>La información detallada de este portafolio es privada.</p>
        </div>
      </ng-template>
    </section>

    <!-- Right: Snapshot Preview Area -->
    <div id="snapshot-area" class="snapshot-card glass-card" *ngIf="isGeneratingSnapshot()">
       <div class="snapshot-header">
          <div class="user-row">
            <div class="mini-avatar">
               {{ profile()?.name?.charAt(0) }}
            </div>
            <div>
              <h3>{{ profile()?.name }}</h3>
              <span>Zenith Finance</span>
            </div>
          </div>
          <div class="qr-placeholder">
            <div class="qr-box">QR</div>
          </div>
       </div>
       
       <div class="snapshot-stats">
          <div class="stat-item">
             <span class="label">Activos</span>
             <span class="val">{{ assets().length }}</span>
          </div>
          <div class="stat-item">
             <span class="label">Top Activo</span>
             <span class="val accent">{{ assets()[0]?.symbol || '-' }}</span>
          </div>
       </div>

       <div class="snapshot-footer">
          zenith.finance/u/{{ profile()?.username }}
       </div>
    </div>
  </main>
</div>

<ng-template #loadingTpl>
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Cargando perfil...</p>
  </div>
</ng-template>
