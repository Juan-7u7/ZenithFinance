<div class="sidebar-overlay" *ngIf="visible()" (click)="close()">
  <div class="sidebar-container glass-card" (click)="$event.stopPropagation()">
    <div class="sidebar-header">
      <div class="title-group">
        <div class="icon-zap">
          <lucide-icon [img]="icons.Zap" size="20"></lucide-icon>
        </div>
        <h2>Centro de Automatización</h2>
      </div>
      <button class="btn-close" (click)="close()">
        <lucide-icon [img]="icons.X" size="20"></lucide-icon>
      </button>
    </div>

    <div class="sidebar-tabs">
      <button 
        [class.active]="activeTab() === 'alerts'" 
        (click)="activeTab.set('alerts')"
      >
        <lucide-icon [img]="icons.Bell" size="16"></lucide-icon>
        Alertas
        <span class="badge" *ngIf="alerts().length > 0">{{ alerts().length }}</span>
      </button>
      <button 
        [class.active]="activeTab() === 'goals'" 
        (click)="activeTab.set('goals')"
      >
        <lucide-icon [img]="icons.Target" size="16"></lucide-icon>
        Metas
        <span class="badge" *ngIf="goals().length > 0">{{ goals().length }}</span>
      </button>
    </div>

    <div class="sidebar-content custom-scrollbar">
      <!-- PRICE ALERTS TAB -->
      <div *ngIf="activeTab() === 'alerts'" class="alerts-list fade-in">
        <div class="empty-state" *ngIf="alerts().length === 0">
           <lucide-icon [img]="icons.BellRing" size="40" class="muted-icon"></lucide-icon>
           <p>No tienes alertas de precio activas.</p>
           <small>Configura una desde tus activos en el dashboard.</small>
        </div>

        <div class="item-card alert-item" *ngFor="let alert of alerts()">
          <div class="item-info">
            <div class="coin-badge">{{ alert.symbol }}</div>
            <div class="condition-info">
              <span class="condition" [class.above]="alert.condition === 'ABOVE'" [class.below]="alert.condition === 'BELOW'">
                {{ alert.condition === 'ABOVE' ? 'Si sube de' : 'Si baja de' }}
              </span>
              <span class="price">${{ alert.target_price | number:'1.2-2' }}</span>
            </div>
          </div>
          <button class="btn-delete" (click)="removeAlert(alert.id)" data-tooltip="Borrar Alerta">
            <lucide-icon [img]="icons.Trash2" size="16"></lucide-icon>
          </button>
        </div>
      </div>

      <!-- GOALS TAB -->
      <div *ngIf="activeTab() === 'goals'" class="goals-list fade-in">
        <div class="empty-state" *ngIf="goals().length === 0">
           <lucide-icon [img]="icons.TrendingUp" size="40" class="muted-icon"></lucide-icon>
           <p>No has establecido ninguna meta aún.</p>
        </div>

        <div class="item-card goal-item" *ngFor="let goal of goals()">
          <div class="goal-header">
            <h4>{{ goal.name }}</h4>
            <span class="target-val">${{ goal.target_amount | number:'1.0-0' }}</span>
          </div>
          
          <div class="mini-progress">
             <div class="track">
                <div class="fill" [style.width.%]="getProgress(goal.target_amount)"></div>
             </div>
             <span class="perc">{{ getProgress(goal.target_amount) | number:'1.0-0' }}%</span>
          </div>

          <div class="goal-actions">
             <button class="btn-delete-sm" (click)="removeGoal(goal.id)">
               <lucide-icon [img]="icons.Trash2" size="14"></lucide-icon> Eliminar Meta
             </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
